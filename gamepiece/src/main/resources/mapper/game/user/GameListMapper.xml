<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="gamepiece.user.game.mapper.UserGameMapper">
	<resultMap type="gamepiece.user.game.domain.UserGame" id="gameList">
		<id 	column="gm_cd" property="gameCode"></id>
		<result column="gm_nm" property="gameName"></result>
		<result column="p_cd" property="platformCode"></result>
		<result column="p_nm" property="platformName"></result>
		<result column="developer" property="developer"></result>
		<result column="gm_enrollment_ymd" property="gameEnrollmentYmd"></result>
		<result column="detail_id" property="detailId"></result>
		<result column="img_id" property="imgId"></result>
		<result column="video_id" property="videoId"></result>
		<result column="description" property="description"></result>
		<result column="price" property="price"></result>
		<result column="genre" property="genre"></result>
		<result column="review_count" property="reviewCount"></result>
		<result column="review_avg" property="reviewAvg"></result>
		<result column="summation" property="summation"></result>
		<result column="admin_id" property="adminId"></result>
		<result column="reg_ymd" property="regYmd"></result>
		<result column="isDelete" property="isDelete"></result> 
	</resultMap>
	<select id="getGameList" parameterType="Pageable" resultMap="gameList">
		/* 사용자 게임 화면 조회 */
		SELECT
			g.gm_cd,
			g.gm_nm,
			g.p_cd,
			p.p_nm,
			g.developer,
			g.gm_enrollment_ymd,
			gd.detail_id,
			gd.img_id,
			gd.video_id,
			gd.`description`,
			gd.price,
			gd.genre,
			gd.review_count,
			gd.review_avg,
			gd.summation,
			gd.admin_id,
			gd.reg_ymd,
			g.is_delete
		FROM
			games g INNER JOIN game_detail gd
			ON g.gm_cd = gd.gm_cd
			INNER JOIN platform p
			ON g.p_cd = p.p_cd
		WHERE
			g.is_delete != 'delete'
		ORDER BY CAST(SUBSTRING_INDEX(g.gm_cd, 'gm_', -1) AS UNSIGNED)
		LIMIT #{rowPerPage} OFFSET #{offset};
	</select>
	
	<select id="getCntGameList" resultType="int">
		/* 게임 목록 총 행의 갯수 */
		SELECT
			COUNT(*)
		FROM
			games g INNER JOIN game_detail gd
			ON g.gm_cd = gd.gm_cd
			INNER JOIN platform p
			ON g.p_cd = p.p_cd;
	</select>
	<select id="getPlatformList"  resultMap="gameList">
		/* 플랫폼 목록 조회 */
		SELECT 
			p_cd, 
			p_nm
		FROM 
			platform;
	</select>
	
	
	<select id="getCntGameListWithPlatform" resultType="int">
		/* 플랫폼에 따른 게임 목록 총 행의 갯수 */
		SELECT
			COUNT(*)
		FROM
			games g INNER JOIN game_detail gd
			ON g.gm_cd = gd.gm_cd
			INNER JOIN platform p
			ON g.p_cd = p.p_cd
		WHERE 
			g.p_cd=#{platformCode};
	</select>
	
	<select id="getGameListWithPlatform" parameterType="map" resultMap="gameList">
		/* 플랫폼 클릭시 해당 게임 목록 조회 */
		SELECT
			g.gm_cd,
			g.gm_nm,
			g.p_cd,
			p.p_nm,
			g.developer,
			g.gm_enrollment_ymd,
			gd.detail_id,
			gd.img_id,
			gd.video_id,
			gd.`description`,
			gd.price,
			gd.genre,
			gd.review_count,
			gd.review_avg,
			gd.summation,
			gd.admin_id,
			gd.reg_ymd,
			g.is_delete
		FROM
			games g INNER JOIN game_detail gd
			ON g.gm_cd = gd.gm_cd
			INNER JOIN platform p
			ON g.p_cd = p.p_cd
		WHERE 
			p.p_cd = #{platformCode}
			AND
			g.is_delete = 'active'
		LIMIT #{pageable.rowPerPage} OFFSET #{pageable.offset};
	</select>
	
	
	
	
</mapper>