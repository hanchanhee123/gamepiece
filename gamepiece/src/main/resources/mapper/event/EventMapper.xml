<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="gamepiece.admin.event.mapper.EventMapper">
	<resultMap type="Event" id="eventResultMap">
		<id 	column="ev_cd" 					property="evCd"/>
		<result column="ev_nm" 					property="evNm" />
		<result column="ev_contents" 			property="evContents" />
		<result column="ev_start_ymd" 			property="evStartYmd" />
		<result column="ev_end_ymd"				property="evEndYmd" />
		<result column="ev_winners_num" 		property="evWinnersNum" />
		<result column="admin_id"	 			property="adminId" />
		<result column="reg-ymd" 				property="regYmd" />
		<result column="ev_img" 				property="evImg" />
		<result column="evp_no" 				property="evpNo" />
		<result column="id" 					property="id" />
		<result column="ev_participate_ymd" 	property="evParticipateYmd" />
		<result column="ev_agreement" 			property="evAgreement" />
	</resultMap>


<select id="getEventList" parameterType="string" resultMap="eventResultMap">
SELECT
	*
FROM
	events;
</select>

<select id="getEventParticipant" parameterType="string" resultMap="eventResultMap">
SELECT
	id
FROM
	event_participations
WHERE
	ev_cd = #{evCd};
</select>

<select id="getEventDetail" parameterType="string" resultMap="eventResultMap">
SELECT
	*
FROM
	events
WHERE
	ev_cd=#{evCd};
</select>

<insert id="addEvent" parameterType="Event">

INSERT INTO events
	(ev_cd, ev_nm, ev_contents, ev_start_ymd, ev_end_ymd, ev_winners_num, admin_id, reg_ymd, ev_img)
	VALUES ((SELECT CONCAT('ev_',LPAD(IFNULL(MAX(SUBSTRING(e.ev_cd,4)+1),0),2,'0')) FROM events e), #{evNm}, #{evContents}, #{evStartYmd}, #{evEndYmd}, #{evWinnersNum}, #{adminId}, CURDATE(), #{evImg});
</insert>




</mapper>