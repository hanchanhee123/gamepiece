<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="~{user/layout/default}">
	<head>
		<link rel="stylesheet" th:href="@{/assets/css/point/point.css}" type="text/css"/>
	</head>
	<th:block layout:fragment="contents-header">
         <div class="">
              <div class="main-div">
            <ul>
                <li class="pointshop-cate"><a th:href="@{/point/imoticon}">이모티콘</a></li>
                <li class="pointshop-cate"><a th:href="@{/point/avatar}">아바타</a></li>
                <li class="pointshop-cate"><a th:href="@{/point/background}">배경프로필</a></li>
                <li class="pointshop-cate"><a th:href="@{/point/frame}">아바타액자</a></li>
                <li class="pointshop-cate"><a th:href="@{/point/etc}">기타</a></li>
                <li class="pointshop-cate"><a th:href="@{/point/imoticon}">구매내역</a></li>
            </ul>
        <div class="pointshop-Hd">
            <div class="pointshop-top">
                <div>
                    
                </div>
                <div class="myPoint">보유 포인트<div><span class="point" id="myPointValue" th:text="${userPoint}"></span> Point</div></div>
            </div>
        </div>
          </div>
         </div>
   	</th:block>
   	<th:block layout:fragment="contents-body">
   	<div class="main_div">
   		<!-- 이모티콘  -->
   	 	<div class="pointshop-cate-name">이모티콘</div>
        <div class="pointShopImg">
	            <div class="slide-div">
		            <div class="left-arrow carousel-control-prev" data-bs-target="#sub-imotion-list" data-bs-slide="prev">
		                <i class="bi bi-chevron-left"></i>
		            </div>
	            <div id="sub-imotion-list" class="slider carousel slide">
	                <div class="carousel-inner">
	                    <div class="sub-games carousel-item" th:each="list, status : ${partitionImoticonList}" th:classappend="${status.first}? 'active'">
		                      <div class="box"  th:each="l:${list}" th:data-ps-cd="${l.itemCd}" th:data-type="etc">
	                                <img th:src="${l.itemImgurl}">
	                                <div th:text="${l.itemName}"></div>
	                                <div th:text="${l.itemPrice}" class="itemName"></div>
	                            </div>
	                    </div>
	                </div>
	            </div>
	            <div class="right-arrow carousel-control-next" data-bs-target="#sub-imotion-list" data-bs-slide="next">
	                <i class="bi bi-chevron-right"></i>
	            </div>
	        </div>
	    </div>
        
		<!-- 프로필이미지 -->
        <div class="pointshop-cate-name">프로필이미지</div>
       <div class="pointShopImg">
            <div id="pointShopImg" class="slider carousel slide">
                <div class="left-arrow carousel-control-prev" data-bs-target="" data-bs-slide="prev">
                    <i class="bi bi-chevron-left"></i>
                </div>
                <div class="carousel-inner">
                    <div class="sub-games carousel-item active">
                        <div class="box-list modal-items" th:each="l : ${avatarList}">
                            <div class="box" th:data-ps-cd="${l.itemCd}" th:data-type="avatar">
                                <img th:src="${l.itemImgurl}">
                                <div th:text="${l.itemName}"></div>
                                <div th:text="${l.itemPrice}" class="itemName"></div>
                            </div>    
                        </div>
                    </div>  
                </div>
                <div class="right-arrow carousel-control-next" data-bs-target="" data-bs-slide="next">
                    <i class="bi bi-chevron-right"></i>
                </div>
            </div>
        </div>
       
        <div class="pointshop-cate-name">배경프로필</div>
        <div class="pointShopImg">
            <div id="pointShopImg" class="slider carousel slide">
                <div class="left-arrow carousel-control-prev" data-bs-target="#pointShopImg" data-bs-slide="prev">
                    <i class="bi bi-chevron-left"></i>
                </div>
                <div class="carousel-inner">
                    <div class="sub-games carousel-item active">
                        <div class="box-list modal-items" th:each="l : ${backList}">
                            <div class="box" th:data-ps-cd="${l.itemCd}" th:data-type="back">
                                <img th:src="${l.itemImgurl}">
                                <div th:text="${l.itemName}"></div>
                                <div th:text="${l.itemPrice}" class="itemName"></div>
                            </div>    
                        </div>
                    </div>  
                </div>
                <div class="right-arrow carousel-control-next" data-bs-target="#pointShopImg" data-bs-slide="next">
                    <i class="bi bi-chevron-right"></i>
                </div>
            </div>
        </div>

        <div class="pointshop-cate-name">아바타액자</div>
        <div class="pointShopImg">
            <div id="pointShopImg" class="slider carousel slide">
                <div class="left-arrow carousel-control-prev" data-bs-target="#pointShopImg" data-bs-slide="prev">
                    <i class="bi bi-chevron-left"></i>
                </div>
                <div class="carousel-inner">
                    <div class="sub-games carousel-item active">
                        <div class="box-list modal-items" th:each="l : ${frameList}">
                            <div class="box" th:data-ps-cd="${l.itemCd}" th:data-type="frame">
                                <img th:src="${l.itemImgurl}">
                                <div th:text="${l.itemName}"></div>
                                <div th:text="${l.itemPrice}" class="itemName"></div>
                            </div>    
                        </div>
                    </div>  
                </div>
                <div class="right-arrow carousel-control-next" data-bs-target="#pointShopImg" data-bs-slide="next">
                    <i class="bi bi-chevron-right"></i>
                </div>
            </div>
        </div>
        <div class="pointshop-cate-name">기타</div>
        <div class="pointShopImg">
            <div id="pointShopImg" class="slider carousel slide">
                <div class="left-arrow carousel-control-prev" data-bs-target="#pointShopImg" data-bs-slide="prev">
                    <i class="bi bi-chevron-left"></i>
                </div>
                <div class="carousel-inner">
                    <div class="sub-games carousel-item " th:each="l, status : ${etcList}" th:classappend="${status.first}? 'active'">
                        <div class="box-list modal-items">
                            <div class="box"  th:data-ps-cd="${l.itemCd}" th:data-type="etc">
                                <img th:src="${l.itemImgurl}">
                                <div th:text="${l.itemName}"></div>
                                <div th:text="${l.itemPrice}" class="itemName"></div>
                            </div>    
                        </div>
                    </div>  
                </div>
                <div class="right-arrow carousel-control-next" data-bs-target="#pointShopImg" data-bs-slide="next">
                    <i class="bi bi-chevron-right"></i>
                </div>
            </div>
        </div>
        
        
    
    
    <div class="modal fade" id="exampleModalToggle" tabindex="-1" role="dialog" aria-labelledby="exampleModalToggleLabel" aria-modal="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
            	<div class="modal-top">
	                <h1 class="modal-title fs-5" id="modal-name">아이템 이름</h1>
	                <p>보유 포인트: <span class="point" th:text="${userPoint}"></span> Point</p>
                </div>
                <p id="modal-cate"></p>
            </div>
            <div class="modal-body">
                <div class="modal-img">
                    <img id="item-img" alt="아이템 이미지" class="img-fluid">
                </div>
                <p id="modal-requiredpoint"></p>
                <p>이 아이템은 환불할 수 없습니다.</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary point-order-Btn">구매하기</button>
                <button type="button" class="btn btn-secondary modal-close-btn" data-bs-dismiss="modal">취소</button>
            </div>
        </div>
    </div>
</div>
</div>

 
         
   	</th:block>
   	<!--/* 사용자 추가 js file */-->
    <th:block layout:fragment="customJsResource"></th:block>
    <!--/* 사용자 추가 js script */-->
    <th:block layout:fragment="customJs">
		<script th:inline="javascript">
			$('.modal-items').click(function(){
				const itemCd= $(this).find('.box').data('psCd');
				if(!itemCd) return ;
				const request = $.ajax({
					url : '/point/modal',
					method : 'get',
					data : { 'itemCd' : itemCd },
					dataType : 'json'
				});
				request.done( data => {
					console.log(data)
					$('#modal-name').text(data.itemName);
			    	$('#item-img').attr('src', data.itemImgurl);
			    	$('#modal-cate').text(data.cateName);
			    	$('.modal-footer').find('.point-order-Btn').attr('data-ps-cd', data.itemCd)
			    											   .attr('data-item-price', data.itemPrice);
			    	const itemPrice = data.itemPrice
			    	const myPointValue = /*[[${userPoint}]]*/"userPoint"; 
			    	if(Number(itemPrice) >= Number(myPointValue)){
			    		alert('포인트가 부족합니다.');
			    		return ;
			    	}
			    	$('#exampleModalToggle').modal('show');
				});
				request.fail( (jqXHR, textStatus, error) => {
					console.log(error)
				});
			});
	    	$('.point-order-Btn').click(function(){
	    		const itemCd= this.dataset.psCd;
	    		const itemPrice= this.dataset.itemPrice;
				console.log(itemCd)
				if(!itemCd) return ;
				
				const $form = $('<form />',{action :'/point/addlog', method :'GET'});
				const log={
					'itemCd' 	: itemCd,
					'userId' 	: /*[[${userId}]]*/"userId",
					'itemPrice' : itemPrice
				}
				for(const key in log){
					const $input = $('<input/>',{name:key, type : 'hidden'});
					$input.val(log[key]);
					$form.append($input)
				}
				$('body').append($form)
				$form.submit();
				
			});
			$('#exampleModalToggle').on('hide.bs.modal', function () {
              //모달이 꺼질때 모든 버튼 인풋 셀렉트 텍스트 에어리어의 포커스를 날린다.
                $('button, input, select, textarea').each(function () {
                    $(this).blur();
                });
            });
			
			
		</script>
		
    	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous">
    		
    	</script>

    </th:block>
</html>