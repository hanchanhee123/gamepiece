<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{user/layout/default}">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" th:href="@{/assets/css/board/addboard.css}" />
    <!-- jQuery 추가 -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- 스마트 에디터 스크립트 -->
    <script type="text/javascript" src="/smarteditor/js/HuskyEZCreator.js" charset="utf-8"></script>
    
    <!-- 웹폰트 추가 -->
  <link href="https://hangeul.pstatic.net/hangeul_static/css/nanum-gothic.css" rel="stylesheet">
    <link href="https://hangeul.pstatic.net/hangeul_static/css/nanum-myeongjo.css" rel="stylesheet">
    
    <!-- 글꼴 스타일 추가 -->
    <style>
        /* 기본 글꼴 정의 */
        .se2_l { font-family: '굴림', Gulim !important; }
        .se2_d { font-family: '돋움', Dotum !important; }
        .se2_b { font-family: '바탕', Batang !important; }
        .se2_ng { font-family: '나눔고딕', 'NanumGothic', sans-serif !important; }
        .se2_nm { font-family: '나눔명조', 'NanumMyeongjo', serif !important; }
        
        /* 에디터 내부 글꼴 적용 */
        #smart_editor2 .se2_input_area {
            font-family: '돋움', Dotum, sans-serif;
        }
        
        /* 드롭다운 메뉴의 글꼴 미리보기 */
        .se2_l_font_fam .se2_l { font-family: '굴림', Gulim !important; }
        .se2_l_font_fam .se2_d { font-family: '돋움', Dotum !important; }
        .se2_l_font_fam .se2_b { font-family: '바탕', Batang !important; }
        .se2_l_font_fam .se2_ng { font-family: '나눔고딕', 'NanumGothic', sans-serif !important; }
        .se2_l_font_fam .se2_nm { font-family: '나눔명조', 'NanumMyeongjo', serif !important; }
    </style>
</head>
<th:block layout:fragment="contents-body">
 <form id="addInquiryForm" th:action="@{/board/inquiry/write}" method="post">
    <main>
      <div class="main_div">
        <div class="content">
					      
          <div>
      
            <input type="text" class="title-bar" 
            		id="inquiryTitle" name="inquiryTitle" placeholder="제목을 입력해주세요">
          </div>



			     <div id="smarteditor">
			  <textarea name="inquiryContent" id="editorTxt" rows="20" cols="50"
			       
			          style="width: 100%; height: 400px; box-sizing: border-box; padding: 10px;"></textarea>
			</div>
			
			
			
			
			
			          <div class="file">
			            <div class="file-details">
			              <div>
			                <span class="file-font">첨부파일</span>
			                <span id="fileName" class="file-name">선택된 파일이 없습니다.</span>
			              </div>
			              <div>
			                <input type="file" id="fileInput" name="file" style="display: none;" />
			                <button type="button" class="upload-button" id="uploadButton">
			                  <span>업로드</span>
			                </button>
			              </div>
			            </div>
			          </div>

          <div id="button">
        
             <button type="button" class="cancel" onclick="location.href='/board/inquiry';">취소</button>
            <button type="button" id="submitBtn" class="btn btn-md rounded font-sm hover-up submit" th:onclick="submitForm()">등록</button>
          </div>
        </div>
      </div>
    </main>
 </form>  
</th:block>

<th:block layout:fragment="customJs">
    <script th:inline="javascript">
    
    window.insertImageCallback = function(sFileUrl, sFileName) {
        var sHTML = '<img src="' + sFileUrl + '" alt="' + sFileName + '">';
        oEditors.getById["editorTxt"].exec("PASTE_HTML", [sHTML]);
    };
    
    
        let oEditors = [];

        // 스마트 에디터 초기화
        $(document).ready(function() {
            // 스마트 에디터 초기화 전에 버전 정보 제거
            $(".se2_multy").hide();
            
            nhn.husky.EZCreator.createInIFrame({
                oAppRef: oEditors,
                elPlaceHolder: "editorTxt",
                sSkinURI: "/smarteditor/SmartEditor2Skin.html",
                fCreator: "createSEditor2",
                htParams: {
                	
                	//툴바 사용 true
                    bUseToolbar: true,
                    //크기조절창 false
                    bUseVerticalResizer: false,
                    // HTML세션 TRUE 
                    bUseModeChanger: true,
                    I18N_LOCALE: 'ko_KR',
                    fOnBeforeUnload: function() {},
                    aAdditionalFontList: [
                        ['나눔고딕', 'NanumGothic'],
                        ['나눔명조', 'NanumMyeongjo']
                    ]
                }
            });

            // 파일 업로드 버튼 클릭 이벤트
            $("#uploadButton").click(function() {
                $("#fileInput").click();
            });

            // 파일 선택 시 파일명 표시
            $("#fileInput").change(function() {
                const fileName = $(this).val().split("\\").pop();
                $("#fileName").text(fileName || "선택된 파일이 없습니다.");
            });
        });

    

        function submitForm() {
            // 에디터 내용을 textarea에 적용
            oEditors.getById["editorTxt"].exec("UPDATE_CONTENTS_FIELD", []);

            let isSubmit = true;
            
           
            // 제목 검사
            const title = $("#inquiryTitle").val();
            if(!title) {
                alert("제목을 입력해주세요.");
                $("#inquiryTitle").focus();
                return;
            }

            // 내용 검사 
            const content = $("#editorTxt").val();
            if(!content || content === '<p>&nbsp;</p>' || content === '') {
                alert("내용을 입력해주세요.");
                oEditors.getById["editorTxt"].exec("FOCUS");
                return;
            }

            // 모든 검증을 통과했을 때만 폼 제출
            if(isSubmit) {
                $("#addInquiryForm").submit();
            }
        }
    	
    </script>
</th:block>
</html>