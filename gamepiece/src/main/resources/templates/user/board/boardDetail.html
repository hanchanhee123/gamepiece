<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{user/layout/default}">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" th:href="@{/assets/css/board/boardDetail.css}" />
    <!-- jQuery 추가 -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- 스마트 에디터 스크립트 -->
    <script type="text/javascript" src="/smarteditor/js/HuskyEZCreator.js" charset="utf-8"></script>
    <!-- 웹폰트 추가 -->
    <link href="https://hangeul.pstatic.net/hangeul_static/css/nanum-gothic.css" rel="stylesheet">
    <link href="https://hangeul.pstatic.net/hangeul_static/css/nanum-myeongjo.css" rel="stylesheet">
    
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.7.2/font/bootstrap-icons.min.css" rel="stylesheet">
</head>



<th:block layout:fragment="contents-body">
    <input type="hidden" id="boardNum" th:value="${boardInfo.boardNum}">
  
				            <div class="titleDiv">
				    <div class="title-details">
				        <div id="titleStyle">
				            <span class="titleFont" th:text="${boardInfo.boardTitle}">제목</span>
				        </div>
				        <div class="user-info-row d-flex align-items-center">
				            <div class="d-flex align-items-center flex-grow-1 gap-3">
				              <img src="data:image/png;base64,..." class="rounded-circle" style="width: 30px; height: 30px;">
				                <span class="username fw-semibold" th:text="${boardInfo.userInfo.userNn}">회원</span>
				                <span class="text-muted small" th:text="${boardInfo.boardYmd}">2012-11-11</span>
				            </div>
				            <!-- 로그인 상태일 때 -->
							<span class="report-text ms-auto" 
							      data-bs-toggle="modal" 
							      data-bs-target="#reportModal"
							      th:if="${session.SID != null}">
							    <i class="bi bi-exclamation-circle-fill text-danger me-1"></i>
							    신고
							</span>
							
							<!-- 비로그인 상태일 때 -->
							<span class="report-text ms-auto" 
							      th:unless="${session.SID != null}"
							      onclick="checkLogin()">
							    <i class="bi bi-exclamation-circle-fill text-danger me-1"></i>
							    신고
							</span>
				        </div> 

			                    <div class="modal fade" id="reportModal" tabindex="-1" aria-labelledby="reportModalLabel" aria-hidden="true">
			    <div class="modal-dialog modal-dialog-centered">
			        <div class="modal-content border-0 shadow-lg">
							     <div class="modal-header bg-dark text-white">
    <h1 class="modal-title fs-5" id="reportModalLabel">
        <div class="d-flex align-items-center gap-2">
            <i class="bi bi-exclamation-octagon-fill text-danger"></i>
            <span>신고하기</span>
        </div>
    </h1>
    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
	</div>
	

							           <div class="modal-body p-4">
				    <form>
				        <div class="mb-4">
				            <label for="report-detail" class="form-label fw-semibold">신고 유저</label>
				            <textarea class="form-control border border-2" 
				                      id="reportedUsernM"
				                      name="reportedUserNm" 
				                      th:text="${boardInfo.userInfo.userNn}"
				                      readonly 
				                      style="resize: none; height: 50px; background-color: #f8f9fa; "
				                      
				            ></textarea>
				            	 <input type="hidden" id="reportedUser" th:value="${boardInfo.userInfo.id}">
				        </div>
				        <div class="mb-3">
				            <label for="report-detail" class="form-label fw-semibold">신고 사유</label>
				            <textarea class="form-control border border-2" 
				                      id="reportContent"
				                      name="reportContent" 
				                      placeholder="신고 사유를 입력해주세요."
				                      style="resize: none; height: 120px;"
				            ></textarea>
				        </div>
				    </form>
				</div>
			            <div class="modal-footer border-top-0">
			                <button type="button" class="btn btn-light rounded-pill px-4" 
			                        data-bs-dismiss="modal">취소</button>
			                <button type="button" class="btn btn-danger rounded-pill px-4" 
			                        onclick="userReport()">신고하기</button>
			            </div>
			        </div>
			    </div>
			</div>
                      
                      
                      
                      

					                     <div class="modal fade" id="reportCompleteModal" aria-hidden="true" 
					     aria-labelledby="reportCompleteModalLabel" tabindex="-1">
					    <div class="modal-dialog modal-dialog-centered">
					        <div class="modal-content border-0 shadow-lg">
					            <div class="modal-header bg-success bg-opacity-10 border-bottom-0">
					                <h1 class="modal-title fs-5 text-success" id="reportCompleteModalLabel">신고완료</h1>
					                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					            </div>
					            <div class="modal-body p-4 text-center">
					                <div class="mb-3">
					                    <i class="bi bi-check-circle-fill text-success fs-1"></i>
					                </div>
					                신고가 접수되었습니다.
					            </div>
					            <div class="modal-footer border-top-0">
					                <button type="button" class="btn btn-success rounded-pill px-4 w-100" 
					                        data-bs-dismiss="modal">확인</button>
					            </div>
					        </div>
					    </div>
					</div>


                    
                </div>
            </div>

							            <div class="boards-content">
			    <div class="content-details">
			        <!-- 네이버 에디터 컨텐츠 (모든 스타일 유지) -->
			        <div th:if="${boardInfo.boardContent.contains('<p>') or boardInfo.boardContent.contains('<div>')}" 
			             class="editor-content"
			             th:utext="${boardInfo.boardContent}">
			        </div>
			        
			        <!-- mapper의 일반 텍스트 (기본 스타일 적용) -->
			        <div th:unless="${boardInfo.boardContent.contains('<p>') or boardInfo.boardContent.contains('<div>')}" 
			             class="plain-text"
			             th:text="${boardInfo.boardContent}">
			        </div>
			    </div>
			</div>
			               
                <div class="likeAndDis">
                    <div class="like-button" id="likeButton">
                        <i class="bi bi-hand-thumbs-up-fill" id="like"></i>
                        <span class="likeCnt" th:text="${boardInfo.boardLikeCnt}">0</span>
                    </div>
                
                    <div class="dislike-button" id="dislikeButton">
                        <i class="bi bi-hand-thumbs-down-fill" id ="disLike"></i>
                        <span class="dislikeCnt" th:text="${boardInfo.boardDisLikeCnt}">0</span>
                    </div>
                </div>



		   
               <div class="board-commentBar" th:each="l : ${commentList}">
                        
    <!-- 댓글 목록 시작 -->
    <div  class="card mb-3 commentBox">

        <div class="card-body">
            <!-- 댓글 헤더 -->
            <div class="d-flex justify-content-between align-items-center mb-3">
                <div class="d-flex align-items-center">
                    <img src="data:image/png;base64,..." class="rounded-circle me-3" style="width: 40px; height: 40px;">
                   <div class="d-flex align-items-center gap-2">
		            <h6 class="mb-0" th:text="${l.userInfo.userNn}">닉네임</h6>
		            <span class="text-muted small" th:text="| (${l.commentYmd})|">게시날짜</span>
        </div>
                </div>
				              <button class="btn btn-outline-danger btn-sm" 
				        data-bs-toggle="modal" 
				        data-bs-target="#commentReportModal"
				        th:attr="data-board-num=${l.boardNum}"
				        th:if="${session.SID != null}">
				    <i class="bi bi-exclamation-circle-fill"></i>
				    <span class="ms-1">신고</span>
				</button>
								
				<!-- 비로그인 상태일 때 -->
				<button class="btn btn-outline-danger btn-sm"
				        onclick="checkLogin()"
				        th:unless="${session.SID != null}">
				    <i class="bi bi-exclamation-circle-fill"></i>
				    <span class="ms-1">신고</span>
				</button>
            </div>

            <!-- 댓글 내용 -->
            <p class="card-text" th:text="${l.commentDetail}">댓글 내용</p>

           <div class="d-flex gap-3 justify-content-end">
    <button class="btn btn-light btn-sm comment-like-btn" id="likeButton2">
        <i class="bi bi-hand-thumbs-up-fill text-primary fs-5"></i>
        <span class="ms-1 likeCnt2" th:text="${l.commentLikeCnt}">0</span>
    </button>
    <button class="btn btn-light btn-sm comment-dislike-btn" id="dislikeButton2">
    	
        <i class="bi bi-hand-thumbs-down-fill text-danger fs-5"></i>
        <span class="ms-1 dislikeCnt2" th:text="${l.commentDisLikeCnt}">0</span>
    </button>
</div>
        </div>
        
        
        
    </div>
   
				         
                
                
                
                 <div class="modal fade" id="commentReportModal" tabindex="-1" aria-labelledby="reportModalLabel" aria-hidden="true">
			    <div class="modal-dialog modal-dialog-centered">
			        <div class="modal-content border-0 shadow-lg">
							     <div class="modal-header bg-dark text-white">
    <h1 class="modal-title fs-5" id="reportModalLabel">
        <div class="d-flex align-items-center gap-2">
            <i class="bi bi-exclamation-octagon-fill text-danger"></i>
            <span>신고하기</span>
        </div>
    </h1>
    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
	</div>
							           <div class="modal-body p-4">
				    <form>
				    
				    	
				        <div class="mb-4">
				            <label for="report-detail" class="form-label fw-semibold">신고 유저</label>
				            <textarea class="form-control border border-2" 
				                      id="commentReportedUserNn"
				                      name="commentReportedUserNn" 
				                     th:text="${l.userInfo.userNn}"
				                      readonly 
				                      style="resize: none; height: 50px; background-color: #f8f9fa; "
				            ></textarea>
				        </div>
				        <div class="mb-3">
				            <label for="report-detail" class="form-label fw-semibold">신고 사유</label>
				            <textarea class="form-control border border-2" 
				                      id="commentReportContent"
				                      name="reportContent" 
				                      placeholder="신고 사유를 입력해주세요."
				                      style="resize: none; height: 120px;"
				            ></textarea>
				             <input type="hidden" id="reportedUser" th:value="${boardInfo.userInfo.id}">
				        </div>
				    </form>
				</div>
			            <div class="modal-footer border-top-0">
			                <button type="button" class="btn btn-light rounded-pill px-4" 
			                        data-bs-dismiss="modal">취소</button>
			                <button type="button" class="btn btn-danger rounded-pill px-4" 
			                        onclick="commentReport()">신고하기</button>
			            </div>
			        </div>
			    </div>
			</div>
                      
                      
                      
                      

					                     <div class="modal fade" id="reportCompleteModal" aria-hidden="true" 
					     aria-labelledby="reportCompleteModalLabel" tabindex="-1">
					    <div class="modal-dialog modal-dialog-centered">
					        <div class="modal-content border-0 shadow-lg">
					            <div class="modal-header bg-success bg-opacity-10 border-bottom-0">
					                <h1 class="modal-title fs-5 text-success" id="reportCompleteModalLabel">신고완료</h1>
					                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					            </div>
					            <div class="modal-body p-4 text-center">
					                <div class="mb-3">
					                    <i class="bi bi-check-circle-fill text-success fs-1"></i>
					                </div>
					                신고가 접수되었습니다.
					            </div>
					            <div class="modal-footer border-top-0">
					                <button type="button" class="btn btn-success rounded-pill px-4 w-100" 
					                        data-bs-dismiss="modal">확인</button>
					            </div>
					        </div>
					    </div>
					</div>
                
                
                </div>
                
                 <div class="pagination-area mt-15" th:if="${commentList != null and not #lists.isEmpty(commentList)}">
				    <nav>
    <ul class="pagination justify-content-center">
        <li class="page-item">
            <a class="page-link" th:href="@{/board/detail(boardNum=${boardInfo.boardNum},currentPage=1)}">
                <i class="material-icons md-first_page"></i>
            </a>
        </li>

        <li class="page-item" th:classappend="${currentPage < 2} ? 'disabled'">
            <a class="page-link"
                th:href="@{/board/detail(boardNum=${boardInfo.boardNum},currentPage=${currentPage -1})}">
                <i class="material-icons md-chevron_left"></i>
            </a>
        </li>

        <th:block th:each="num : ${#numbers.sequence(startPageNum, endPageNum)}">
            <li class="page-item" th:classappend="${num == currentPage} ? 'active'">
                <a class="page-link" 
                    th:href="@{/board/detail(boardNum=${boardInfo.boardNum},currentPage=${num})}" 
                    th:text="${num}">
                </a>
            </li>
        </th:block>

        <li class="page-item" th:classappend="${currentPage eq lastPage} ? disabled">
            <a class="page-link"
                th:href="@{/board/detail(boardNum=${boardInfo.boardNum},currentPage=${currentPage+1})}">
                <i class="material-icons md-chevron_right"></i>
            </a>
        </li>

        <li class="page-item">
            <a class="page-link"
                th:href="@{/board/detail(boardNum=${boardInfo.boardNum},currentPage=${lastPage})}">
                <i class="material-icons md-last_page"></i>
            </a>
        </li>
    </ul>
</nav>
				</div>
				
				
                
                
      <form id="addCommentForm" method="post" th:action="@{/board/addComment}">
   <div class="CommentInput-div card w-100">
       <input type="hidden" name="boardNum" th:value="${boardNum}">
       <div class="inputComment">
           <textarea id="commentDetail" 
                     name="commentDetail"
                     class="form-control mb-2 commentInsert"
                     placeholder="덧글내용을 입력해주세요"
                     rows="3"
                     style="resize: none;"></textarea>
       </div>
      <div class="d-flex justify-content-end">
    <!-- 로그인 상태일 때 -->
    <button type="button" class="btn btn-primary commentSubmitBtn" 
            th:if="${session.SID != null}" 
            onclick="submitComment(); return false;">등록</button>
    <!-- 비로그인 상태일 때 -->
    <button type="button" class="btn btn-primary" 
            th:unless="${session.SID != null}" 
            onclick="checkLogin();">등록</button>
</div>
   </div>
</form>
</th:block>

<!--/* 사용자 추가 js file */-->
<th:block layout:fragment="customJsResource">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
	<script th:src="@{/assets/js/home/homeJs.js}"></script>
</th:block>
<!--/* 사용자 추가 js script */-->
<th:block layout:fragment="customJs">
    <script th:inline="javascript">
    
    function checkLogin() {
        alert('로그인 후 사용 가능합니다.');
        location.href = '/login';
    }
    
    
        document.getElementById('likeButton').addEventListener('click', function() {
            const likeCountElement = document.querySelector('.likeCnt');
            let currentCount = parseInt(likeCountElement.textContent, 10);
            likeCountElement.textContent = currentCount + 1;
            
            // 서버로 좋아요 증가 요청 보내기
            sendLikeDislikeRequest('like');
        });
        
        document.getElementById('dislikeButton').addEventListener('click', function() {
            const dislikeCountElement = document.querySelector('.dislikeCnt');
            let currentCount = parseInt(dislikeCountElement.textContent, 10);
            dislikeCountElement.textContent = currentCount + 1;
            
            

            // 서버로 싫어요 증가 요청 보내기
            sendLikeDislikeRequest('dislike');
        });
        
        document.getElementById('likeButton2').addEventListener('click', function() {
            const likeCountElement = document.querySelector('.likeCnt2');
            let currentCount = parseInt(likeCountElement.textContent, 10);
            likeCountElement.textContent = currentCount + 1;
        });
        
        document.getElementById('dislikeButton2').addEventListener('click', function() {
            const dislikeCountElement = document.querySelector('.dislikeCnt2');
            let currentCount = parseInt(dislikeCountElement.textContent, 10);
            dislikeCountElement.textContent = currentCount + 1;
        });
        
        
        
        function userReport() {
        	  const reportContent = document.getElementById('reportContent').value.trim();
        	  const reportedUser = document.getElementById('reportedUser').value.trim();
        	  const boardNum = document.getElementById('boardNum').value;

        	  if (reportContent === '') {
        	    alert('신고 사유를 입력해주세요.');
        	    return;
        	  }

        	  $.ajax({
        	    url: '/board/report',
        	    type: 'POST',
        	    data: {
        	      reportedUser: reportedUser,
        	      reportContent: reportContent,
        	      boardNum: boardNum
        	    },
        	    success: function(response) {
        	      // 첫 번째 모달 닫기
        	      $('#reportModal').modal('hide');

        	      // 첫 번째 모달이 닫힌 후에 리다이렉트
        	      $('#reportModal').on('hidden.bs.modal', function () {
        	        window.location.href = response;
        	      });

        	      // 완료 모달 표시
        	      $('#reportCompleteModal').modal('show');
        	    }
        	  });
        	}
        
        
        
        function commentReport() {
            const reportContent = document.getElementById('commentReportContent').value.trim();
            const reportedUser = document.getElementById('reportedUser').value.trim();
            const boardNum = document.getElementById('boardNum').value;
            
            if (reportContent === '') {
                alert('신고 사유를 입력해주세요.');
                return;
            }
            
            $.ajax({
                url: '/board/report',
                type: 'POST',
                data: {
                    reportedUser: reportedUser,
                    reportContent: reportContent,
                    boardNum: boardNum
                },
                success: function(response) {
                    $('#commentReportModal').modal('hide');
                    
                    $('#reportCompleteModal').on('hidden.bs.modal', function () {
                        window.location.href = response;
                    });
                    $('#reportCompleteModal').modal('show');
                    
                   
                }
            });
        }
        
        
        
        
     // 덧글 등록
function submitComment() {
    const $formControl = $('#addCommentForm').find('#commentDetail');
    const value = $formControl.val().trim();  

    if(!value) { 
        alert('필수 입력 항목입니다.');
        $formControl.focus();
        return false;
    }

   
    $('#addCommentForm').submit();
}

        
    </script>
</th:block>
</html>