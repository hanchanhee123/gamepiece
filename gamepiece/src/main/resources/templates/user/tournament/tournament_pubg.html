<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="~{user/layout/default}">
<head>
	<link rel="stylesheet" th:href="@{/assets/css/tournament/tournament.css}" />
</head>
	 	<th:block layout:fragment="contents-header">
		<div class="main-div">
		   <div class = "tournament-menu">
		       <ul>
		           <li><a th:href="@{/tournament/list}" class="button-list">LoL</a></li>
		           <li><a th:href="@{/tournament/list/valorant}" class="button-list">Valorant</a></li>
		           <li><a th:href="@{/tournament/list/pubg}" class="button-list active">PUBG</a></li>
		           <li><a th:href="@{/tournament/matchPrediction}" class="button-list">승부예측</a></li>
		       </ul>
			</div>
		</th:block>
		<th:block layout:fragment="contents-body">
			<div class="tournament-div">
			    <div class="match-info">
			        <select class="select-year" name="year">
			            <option value="2024" th:selected="${year} == '2024'">2024년</option>
			            <option value="2025" th:selected="${year} == '2025'">2025년</option>
			        </select>
			        <select class="select-month" name="month">
			            <option value="01" th:selected="${month} == '01'">1월</option>
			            <option value="02" th:selected="${month} == '02'">2월</option>
			            <option value="03" th:selected="${month} == '03'">3월</option>
			            <option value="04" th:selected="${month} == '04'">4월</option>
			            <option value="05" th:selected="${month} == '05'">5월</option>
			            <option value="06" th:selected="${month} == '06'">6월</option>
			            <option value="07" th:selected="${month} == '07'">7월</option>
			            <option value="08" th:selected="${month} == '08'">8월</option>
			            <option value="09" th:selected="${month} == '09'">9월</option>
			            <option value="10" th:selected="${month} == '10'">10월</option>
			            <option value="11" th:selected="${month} == '11'">11월</option>
			            <option value="12" th:selected="${month} == '12'">12월</option>
			        </select>
			    </div>
			    <div class="tournament-match">
				    <!-- <div class="match-date">
				        <p>24. 10. 03 목</p>
				    </div>
				    <div class="match-time">
				        <div>
				            <div class="time-day">
				                <p>21:00</p>
				            </div>
				            <div class="is-state-end">
				                <p>경기 종료</p>
				            </div>
				            <div class="score-div">
				                <div class="team1">
				                    <p>team1</p>
				                    <i class="bi bi-image"></i>
				                    <div class="team-win">
				                        <p>1</p>
				                    </div>
				                </div>
				                <div class="team2">
				                    <div class="team-lose">
				                        <p>0</p>
				                    </div>
				                    <i class="bi bi-image"></i>
				                    <p>team2</p>
				                </div>
				            </div>
				        </div>
				    </div>
				    <div class="match-time">
				        <div>
				            <div class="time-day">
				                <p>22:00</p>
				            </div>
				            <div class="is-state-end">
				                <p>경기 종료</p>
				            </div>
				            <div class="score-div">
				                <div class="team1">
				                    <p>team1</p>
				                    <i class="bi bi-image"></i>
				                    <div class="team-win">
				                        <p>1</p>
				                    </div>
				                </div>
				                <div class="team2">
				                    <div class="team-lose">
				                        <p>0</p>
				                    </div>
				                    <i class="bi bi-image"></i>
				                    <p>team2</p>
				                </div>
				            </div>
				            
				        </div>
				    </div>
				    <div class="match-time">
				        <div>
				            <div class="time-day">
				                <p>23:00</p>
				            </div>
				            <div class="is-state-end">
				                <p>경기 종료</p>
				            </div>
				            <div class="score-div">
				                <div class="team1">
				                    <p>team1</p>
				                    <i class="bi bi-image"></i>
				                    <div class="team-win">
				                        <p>1</p>
				                    </div>
				                </div>
				                <div class="team2">
				                    <div class="team-lose">
				                        <p>0</p>
				                    </div>
				                    <i class="bi bi-image"></i>
				                    <p>team2</p>
				                </div>
				            </div>
				        </div>
				    </div>
				    <div class="match-date">
				        <p>24. 10. 04 금</p>
				    </div>
				    <div class="match-time">
				        <div>
				            <div class="time-day">
				                <p>00:25</p>
				            </div>
				            <div class="is-state-ing">
				                <p>진행중</p>
				            </div>
				            <div class="score-div">
				                <div class="team1">
				                    <p>team1</p>
				                    <i class="bi bi-image"></i>
				                    <div class="team-lose">
				                        <p>0</p>
				                    </div>
				                </div>
				                <div class="team2">
				                    <div class="team-lose">
				                        <p>0</p>
				                    </div>
				                    <i class="bi bi-image"></i>
				                    <p>team2</p>
				                </div>
				            </div>
				        </div>
				    </div>
				    <div class="match-time">
				        <div>
				            <div class="time-day">
				                <p>01:25</p>
				            </div>
				            <div class="is-state-end">
				                <p>예정</p>
				            </div>
				            <div class="score-div">
				                <div class="team1">
				                    <p>team1</p>
				                    <i class="bi bi-image"></i>
				                    <div class="team-lose">
				                        <p>0</p>
				                    </div>
				                </div>
				                <div class="team2">
				                    <div class="team-lose">
				                        <p>0</p>
				                    </div>
				                    <i class="bi bi-image"></i>
				                    <p>team2</p>
				                </div>
				            </div>
				        </div>
				    </div>
				    <div class="match-time">
				        <div>
				            <div class="time-day">
				                <p>02:25</p>
				            </div>
				            <div class="is-state-end">
				                <p>예정</p>
				            </div>
				            <div class="score-div">
				                <div class="team1">
				                    <p>team1</p>
				                    <i class="bi bi-image"></i>
				                    <div class="team-lose">
				                        <p>0</p>
				                    </div>
				                </div>
				                <div class="team2">
				                    <div class="team-lose">
				                        <p>0</p>
				                    </div>
				                    <i class="bi bi-image"></i>
				                    <p>team2</p>
				                </div>
				            </div>
				        </div>
				    </div> -->
				</div>
			</div>
		</th:block>
    </div>
    <!--/* 사용자 추가 js file */-->
    <th:block layout:fragment="customJsResource">
    	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    	<script th:src="@{/assets/js/tournament/tournament.js}"></script>
    </th:block>
    <!--/* 사용자 추가 js script */-->
    <th:block layout:fragment="customJs">
		<script th:inline="javascript">
			const $selectYear = $('.select-year').val();
			const $selectMonth = $('.select-month').val();
			
			const startDay = new Date($selectYear,$selectMonth-1,0)
			const endDay = new Date($selectYear,$selectMonth,0)
			
			const leageName = /*[[${leageName}]]*/"";
			const gameName = /*[[${gameName}]]*/"";
			
			const startStrDate = createSearchDate(startDay);
			const endStrDate = createSearchDate(endDay);
			
			function createSearchDate(day){
				const year = day.getFullYear();
				const month = day.getMonth()+1;
				const date = day.getDate();
				
				const print = `${year}-${month}-${date} 15:00:00`;
				
				return print;
			}
			
			function getAjaxFn(selectYear, selectMonth){
				const $tournamentDiv = $('.tournament-match');
				const request = $.ajax({
					url : 'https://api-foc.krafton.com/tournament/match-schedule',
					method : 'get',
					data : {
						'searchStartDt' : startStrDate,
						'searchEndDt' : endStrDate
					},
					beforeSend : function(jqXHR){
						jqXHR.setRequestHeader('service-namespace', 'PUBG_ESPORTS-c0ce');
					},
					dataType : 'json'
				});
				request.done(function(data){
					console.log(data);
					const reverseArr = [...data._embedded.list].reverse(); 
					
					for(const list of reverseArr){
						const $matchDate = $('<div />',{
							'class' : 'match-date'
						});
						
						console.log(list.startAt);
						
						const $p = $('<p />');
						$p.text();
						console.log($p[0]);
					}
				});
				request.fail(function(jQXHR, textStatus, error){
    				console.log(error);
    				const $div = $('<div />',{
						'class' : 'match-date'
					});
					const $p = $('<p />');
					$p.text('대회 일정을 찾을 수 없습니다.');
					$div.append($p);
					$tournamentDiv.append($div);
    			});	
			}
			
			getAjaxFn($selectYear, $selectMonth);
			
			$('.select-year').change(function(){
				const $selectYear = $('.select-year').val();
				const $selectMonth = $('.select-month').val();
				getAjaxFn($selectYear, $selectMonth);
				location.href = `/tournament/list/pubg?year=${$selectYear}&month=${$selectMonth}`;
			});
			
			$('.select-month').change(function(){
				const $selectYear = $('.select-year').val();
				const $selectMonth = $('.select-month').val();
				getAjaxFn($selectYear, $selectMonth);
				location.href = `/tournament/list/pubg?year=${$selectYear}&month=${$selectMonth}`;
			});
		</script>
    </th:block>
</html>